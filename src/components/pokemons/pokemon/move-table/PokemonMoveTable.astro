---
import { VersionGroup, VersionGroupById } from "src/utils/data-read";
import { capitalizeSnakeCase } from "src/utils/string";
import MoveMethodSection from "./MoveMethodSection.astro";

const versionGroupIds = VersionGroup.map((versionGroup) => versionGroup.id);

const { pokemonMoveByMethod } = Astro.props;
---

<table class="!table w-full table-auto border-collapse">
  <colgroup>
    {versionGroupIds.map((id) => <col id={`col-${id}`} />)}
  </colgroup>
  <thead>
    <tr>
      {
        versionGroupIds.map((id) => (
          <th>
            <button class=" mx-auto aspect-square w-[2em] cursor-pointer" type="button" id={id} aria-expanded={true}>
              -
            </button>
          </th>
        ))
      }
    </tr>
    <tr>
      {versionGroupIds.map((id) => <th>{capitalizeSnakeCase(VersionGroupById[id].identifier)}</th>)}
      <th>Move</th>
      <th>Type</th>
      <th>Power</th>
      <th>Accuracy</th>
      <th>PP</th>
    </tr>
  </thead>
  {
    Object.entries(pokemonMoveByMethod).map(([pokemon_move_method_id, pokemonMoveByMove]) => (
      <MoveMethodSection pokemon_move_method_id={pokemon_move_method_id} pokemonMoveByMove={pokemonMoveByMove} />
    ))
  }
</table>
<style>
  th {
    padding: 0 0.5em;
  }
  tr {
    border-bottom: 1px solid var(--sl-color-gray-6);
  }
</style>
<script define:vars={{ versionGroupIds }}>
  versionGroupIds.forEach((buttonId) => {
    const button = document.getElementById(String(buttonId));
    const otherIds = versionGroupIds.filter((id) => id !== buttonId);
    button.addEventListener("click", () => {
      console.log(button.innerHTML);
      if (button.ariaExpanded === "true") {
        otherIds.forEach((id) => {
          const col = document.getElementById(`col-${id}`);
          col.style.visibility = "collapse";
          const otherButton = document.getElementById(id);
          otherButton.disabled = true;
        });
        button.ariaExpanded = false;
        button.innerHTML = "+";
      } else {
        versionGroupIds.forEach((id) => {
          const col = document.getElementById(`col-${id}`);
          col.style.visibility = "visible";
          const anyButton = document.getElementById(id);
          anyButton.disabled = false;
        });
        button.ariaExpanded = true;
        button.innerHTML = "-";
      }
    });
  });
</script>
