---
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import { type GetStaticPaths } from "astro";
import PageNumberLink from "src/components/pagination/PageNumberLink.astro";
import PageNumberLinkEllipsis from "src/components/pagination/PageNumberLinkEllipsis.astro";
import TypeIcon from "src/components/pokemons/pokemon/TypeIcon.astro";
import { Pokemon, PokemonTypeByPokemonId } from "src/utils/data-read";
import { capitalizeSnakeCase } from "src/utils/string";

import { Icon } from "@astrojs/starlight/components";

export const getStaticPaths = (({ paginate }) => {
  return paginate(
    Pokemon.map(({ id, identifier }) => ({
      id,
      identifier,
    })),
    { pageSize: 60 }
  );
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const headings = [{ depth: 2, slug: "list-of-pokemons", text: "List of Pokemons" }];
---

<!--Display the current page number. Astro.params.page can also be used!-->
<StarlightPage frontmatter={{ title: "Pokemons", pagefind: false }} headings={headings}>
  <h2 id={headings[0].slug}>{headings[0].text}</h2>
  <div class="pokemon-grid not-content">
    {
      page.data.map(({ id, identifier }) => {
        const pokemonName = capitalizeSnakeCase(identifier!);
        return (
          <div class=" m-2 p-2 ring-1 rounded-md flex flex-col items-stretch justify-between ring-slate-200 shadow">
            <p class="text-center font-semibold">{pokemonName}</p>
            <a class="flex justify-center" href={`/pokemons/pokemon/${id}`}>
              <img
                src={`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`}
                alt={pokemonName}
                loading="lazy"
              />
            </a>
            <div class="flex justify-around gap-1">
              {PokemonTypeByPokemonId[id].map((pokemonType) => (
                <TypeIcon type_id={pokemonType.type_id} />
              ))}
            </div>
          </div>
        );
      })
    }
  </div>
  <div class="text-center">
    No.<strong>{page.start + 1}</strong> - <strong>{page.end + 1}</strong> of total <strong>{page.total}</strong> Pokemons
  </div>
  <div class="not-content flex justify-center">
    <nav class="flex flex-wrap rounded-md shadow-sm -space-x-px">
      <a
        class="inline-flex items-center align-middle text-center px-2 text-gray-900 rounded-s-md ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
        href={page.url.prev}
      >
        <Icon name="left-arrow" />
      </a>
      <PageNumberLinkEllipsis baseUrl="/pokemons/list/" startPage={1} endPage={page.currentPage - 1} />
      <PageNumberLink pageNumber={page.currentPage} isHighlighted={true} />
      <PageNumberLinkEllipsis baseUrl="/pokemons/list/" startPage={page.currentPage + 1} endPage={page.lastPage} />
      <a
        class="inline-flex items-center px-2 text-gray-900 rounded-e-md ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
        href={page.url.next}
      >
        <Icon name="right-arrow" />
      </a>
    </nav>
  </div>
</StarlightPage>
<style>
  .pokemon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(max(144px, 100% / 6), 1fr));
  }
</style>
