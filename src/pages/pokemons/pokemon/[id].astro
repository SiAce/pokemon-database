---
import TypeIcon from "src/components/pokemons/pokemon/TypeIcon.astro";
import {
  AbilityById,
  MoveById,
  Pokemon,
  PokemonAbilityByPokemonId,
  PokemonById,
  PokemonMoveByPokemonId,
  PokemonMoveMethodById,
  PokemonStatByPokemonId,
  PokemonTypeByPokemonId,
  StatById,
  VersionGroupById,
} from "src/utils/data-read";
import statColorJson from "src/utils/stat-color.json";
import { capitalizeSnakeCase } from "src/utils/string";

export function getStaticPaths() {
  return Pokemon.map((pokemon) => ({
    params: { id: pokemon.id },
  }));
}

const { id } = Astro.params;
const pokemon = PokemonById[id];
const { identifier, species_id, height, weight, base_experience, is_default } = pokemon;
const [name] = [identifier].map(capitalizeSnakeCase);
const pokemonMoves = PokemonMoveByPokemonId[id];

const pokemonMoveByVersionGroupId = {};
if (pokemonMoves) {
  for (let i = 0; i < pokemonMoves.length; i++) {
    if (pokemonMoves[i].version_group_id in pokemonMoveByVersionGroupId) {
      pokemonMoveByVersionGroupId[pokemonMoves[i].version_group_id].push(pokemonMoves[i]);
    } else {
      pokemonMoveByVersionGroupId[pokemonMoves[i].version_group_id] = [pokemonMoves[i]];
    }
  }
}

const headings = [
  { depth: 2, slug: "basic-info", text: "Basic Info" },
  { depth: 2, slug: "sprites", text: "Sprites" },
  { depth: 2, slug: "moves", text: "Moves" },
];
---

<h2 id={headings[0].slug}>{headings[0].text}</h2>
<div title={`#${id} ${name}`}>
  <div>
    <img
      src={`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${id}.png`}
      width={300}
      height={300}
      alt={name}
    />
    <div>
      <h4>Type</h4>
      <div>
        {PokemonTypeByPokemonId[id].map((pokemonType) => <TypeIcon type_id={pokemonType.type_id} />)}
      </div>
    </div>
    <div>
      <h4>Abilities</h4>
      <div>
        {
          PokemonAbilityByPokemonId[id].map((pokemonAbility) => (
            <a>
              <span>{capitalizeSnakeCase(AbilityById[pokemonAbility.ability_id].identifier)}</span>
            </a>
          ))
        }
      </div>
    </div>
    <div>
      <h4>Base Stats</h4>
      <div>
        {
          PokemonStatByPokemonId[id].map((pokemonStat) => (
            <a
              style={{
                backgroundColor: statColorJson[StatById[pokemonStat.stat_id].identifier],
              }}
              href="#"
            >
              <div>
                <div>{capitalizeSnakeCase(StatById[pokemonStat.stat_id].identifier)}</div>
                <div>{pokemonStat.base_stat}</div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
    <div>
      <h4>Effort Value Yield</h4>
      <div>
        {
          PokemonStatByPokemonId[id].map((pokemonStat) => (
            <a
              style={{
                backgroundColor: statColorJson[StatById[pokemonStat.stat_id].identifier],
              }}
              href="#"
            >
              <div>
                <div>{capitalizeSnakeCase(StatById[pokemonStat.stat_id].identifier)}</div>
                <div>{pokemonStat.effort}</div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
    <div>
      <h4>Base Experience</h4>
      <div>{base_experience}</div>
    </div>
    <div>
      <div>
        <h4>Height</h4>
        <p>{height! / 10} m</p>
      </div>
      <div>
        <h4>Weight</h4>
        <p>{weight! / 10} kg</p>
      </div>
    </div>
  </div>
</div>
<hr />
<h2 id={headings[2].slug}>{headings[2].text}</h2>
{
  (
    <div>
      <ul>
        {Object.keys(pokemonMoveByVersionGroupId).map((version_group_id) => (
          <li>{capitalizeSnakeCase(VersionGroupById[version_group_id].identifier)}</li>
        ))}
      </ul>
      <table class="not-content w-full !table table-auto text-center">
        <thead>
          <tr>
            <th>Level</th>
            <th>Move</th>
            <th>Type</th>
            <th>Learn Method</th>
            <th>Power</th>
            <th>Accuracy</th>
            <th>PP</th>
          </tr>
        </thead>
        <tbody>
          {pokemonMoves.map((pokemonMove: any) => (
            <tr>
              <td>{pokemonMove.level}</td>
              <td>{capitalizeSnakeCase(MoveById[pokemonMove.move_id].identifier)}</td>
              {/* <td>{<TypeIcon type_id={MoveById[pokemonMove.move_id].type_id} />}</td> */}
              <td>{capitalizeSnakeCase(PokemonMoveMethodById[pokemonMove.pokemon_move_method_id].identifier)}</td>
              <td>{MoveById[pokemonMove.move_id].power}</td>
              <td>{MoveById[pokemonMove.move_id].accuracy}</td>
              <td>{MoveById[pokemonMove.move_id].pp}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )
}
