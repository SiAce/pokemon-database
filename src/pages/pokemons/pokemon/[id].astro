---
import { Card } from "@astrojs/starlight/components";
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import statColorJson from "../../../utils/stat-color.json";
import { capitalizeFirstLetter, capitalizeSnakeCase } from "../../../utils/string";
import typeColorJson from "../../../utils/type-color.json";
import { db, Pokemon } from "astro:db";
import { eq } from "astro:db";
import { PokemonSpecies } from "astro:db";

export async function getStaticPaths() {
  const pokemons = await db.select({ id: Pokemon.id }).from(Pokemon).limit(20);
  return pokemons.map((pokemon) => ({
    params: { id: pokemon.id },
  }));
}

const { id } = Astro.params;

const pokemon = (
  await db
    .select()
    .from(Pokemon)
    .innerJoin(PokemonSpecies, eq(Pokemon.species_id, PokemonSpecies.id))
    .where(eq(Pokemon.id, id))
)[0];

const { identifier } = pokemon.Pokemon;
const pokemonName = capitalizeSnakeCase(identifier)

const headings = [
  { depth: 2, slug: "overview", text: "Overview" },
  { depth: 2, slug: "sprites", text: "Sprites" },
  { depth: 2, slug: "moves", text: "Moves" },
];
---

<StarlightPage frontmatter={{ title: pokemonName }} headings={headings}>
  <h2 id={headings[0].slug}>{headings[0].text}</h2>
  <Card title={pokemonName}>
    <div class="flex flex-col divide-y-2 gap-4">
      <img
        class="mx-auto w-1/2"
        src={`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${id}.png`}
      />
      <!-- <div>
        <h4 class="my-2">Type</h4>
        <div>
          {
            types.map((type: any) => (
              <a class="no-underline" href="#">
                <span
                  class={`px-4 py-2 mr-4 text-gray-50`}
                  style={{
                    backgroundColor: (typeColorJson as any)[type.type.name],
                  }}
                >
                  {capitalizeFirstLetter(type.type.name)}
                </span>
              </a>
            ))
          }
        </div>
      </div>
      <div>
        <h4 class="my-2">Abilities</h4>
        <div>
          {
            abilities.map((ability: any) => (
              <a class="no-underline" href="#">
                <span class="rounded-md bg-gray-400 px-4 py-2 mr-4 font-semibold text-gray-50 ring-1 ring-inset ring-gray-500/10">
                  {capitalizeFirstLetter(ability.ability.name)}
                </span>
              </a>
            ))
          }
        </div>
      </div>
      <div>
        <h4 class="my-2">Base Stats</h4>
        <div class="flex justify-between flex-wrap gap-1">
          {
            stats.map((stat: any) => (
              <a
                class="no-underline flex-1 rounded-md text-center font-semibold text-gray-50 ring-1 ring-inset ring-gray-500/10 flex justify-center"
                style={{
                  backgroundColor: (statColorJson as any)[stat.stat.name],
                }}
                href="#"
              >
                <div class="flex flex-col justify-between text-gray-700 py-2 text-sm">
                  <div>{capitalizeSnakeCase(stat.stat.name)}</div>
                  <div>{stat.base_stat}</div>
                </div>
              </a>
            ))
          }
        </div>
      </div>
      <div>
        <h4 class="my-2">Effort Value Yield</h4>
        <div class="flex justify-between flex-wrap gap-1">
          {
            stats.map((stat: any) => (
              <a
                class="no-underline flex-1 rounded-md text-center font-semibold text-gray-50 ring-1 ring-inset ring-gray-500/10 flex justify-center"
                style={{
                  backgroundColor: (statColorJson as any)[stat.stat.name],
                }}
                href="#"
              >
                <div class="flex flex-col justify-between text-gray-700 py-2 text-sm">
                  <div>{capitalizeSnakeCase(stat.stat.name)}</div>
                  <div>{stat.effort}</div>
                </div>
              </a>
            ))
          }
        </div>
      </div>
      <div class="py-2">
        <h4>Base Experience</h4>
        <div class="pl-2">{base_experience}</div>
      </div>
      <div class="flex justify-stretch divide-x-2">
        <div class="flex-auto mt-4 pl-2">
          <h4>Height</h4>
          <p>{height / 10} m</p>
        </div>
        <div class="flex-auto !mt-4 pl-2">
          <h4>Weight</h4>
          <p>{weight / 10} kg</p>
        </div>
      </div>
    </div> -->
  </Card>
</StarlightPage>
